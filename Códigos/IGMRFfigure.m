% 
% 

clear all, close all
n = 100;
k   = n - 1;
tau1 = 0.1;
gene_coaltimes = [0.04216554 0.0709894 0.5768421 0.7103944 0.7392463 0.9142574 1.076984 1.084363 1.181686 1.200272 1.211072 1.319885 1.377551 1.772545 1.785333 1.786439 1.823791 1.826026 1.831869 1.847594 1.904907 1.973787 2.073285 2.095521 2.112877 2.135613 2.205047 2.213348 2.23563 2.244775 2.289587 2.298551 2.400001 2.408635 2.416646 2.431035 2.456966 2.45849 2.489318 2.511417 2.541195 2.604091 2.630077 2.679224 2.697358 2.804671 2.904866 2.917287 2.958113 2.985067 3.050493 3.0749 3.191444 3.301089 3.310482 3.366467 3.41337 3.434908 3.525368 3.536481 3.554791 3.555891 3.604059 3.613114 3.619499 3.675029 3.682004 3.709343 3.790251 3.822578 3.823964 3.858901 3.946071 3.955254 3.979964 4.100398 4.276391 4.379365 4.397183 4.470931 4.543001 4.717515 4.753785 4.79572 5.076546 5.085152 5.144554 5.347529 5.425611 5.484909 5.523534 5.532714 5.67969 5.735023 5.792867 5.906247 6.013852 7.040122 7.140931];

gene_intercoal =  [0.04216554 0.02882386 0.5058527 0.1335523 0.02885188 0.1750112 0.1627265 0.007379269 0.09732315 0.01858588 0.01079956 0.1088136 0.0576656 0.3949942 0.01278815 0.001105848 0.03735237 0.002234238 0.005843385 0.01572498 0.05731304 0.06887997 0.09949806 0.02223602 0.0173558 0.02273558 0.06943416 0.008300986 0.02228231 0.009145272 0.04481218 0.008964015 0.1014496 0.008634223 0.008011185 0.01438874 0.02593066 0.001523819 0.0308281 0.02209912 0.02977855 0.06289561 0.02598607 0.04914692 0.01813379 0.1073128 0.1001951 0.0124215 0.040826 0.02695411 0.06542557 0.02440713 0.1165435 0.1096458 0.009392637 0.05598474 0.04690267 0.02153852 0.09046035 0.01111284 0.01830928 0.001100706 0.04816755 0.009055633 0.006384549 0.05553034 0.00697427 0.0273397 0.08090783 0.03232642 0.00138639 0.03493713 0.08717015 0.009183297 0.02470995 0.120434 0.1759931 0.1029738 0.01781771 0.07374829 0.07207018 0.1745139 0.03626931 0.04193537 0.2808263 0.008606025 0.0594019 0.2029744 0.07808249 0.05929815 0.03862445 0.009180355 0.1469757 0.055333 0.05784393 0.1133806 0.1076051 1.02627 0.1008091];

midpoint_distance = (gene_intercoal(1:end-1) + gene_intercoal(2:end))/2;
one_vec = ones(k-1,1)./midpoint_distance';
diag = [one_vec(1); (one_vec(1:end-1) + one_vec(2:end)); one_vec(end-1)];
Q1D     = tau1*spdiags([[-one_vec; 0] diag -[0; one_vec]],[-1 0 1],k,k);
L       = chol(Q1D);
v       = randn(k,5);
samps   = L\v;
figure(1)
  plot(gene_coaltimes, samps,'k')
  axis([min(gene_coaltimes) max(gene_coaltimes) min(samps(:)) max(samps(:))])
  xlabel('Time')
  title('Sampling from Gaussian Markov Random Field $\tau = 1$','interpreter','latex')
  
tau2 = 100;
Q1D2     = tau2*spdiags([[-one_vec; 0] diag -[0; one_vec]],[-1 0 1],k,k);
L2       = chol(Q1D2);
v2       = randn(k,5);
samps2   = L2\v2;
figure(2)
  plot(gene_coaltimes, samps2,'k')
  axis([min(gene_coaltimes) max(gene_coaltimes) min(samps2(:)) max(samps2(:))])
  xlabel('Time')
  title('Sampling from Gaussian Markov Random Field $\tau = 2$','interpreter','latex')

%Example from here: https://github.com/bardsleyj/SIAMBookCodes/blob/master/Chapter%205/GMRFzero.m
n       = 128;
one_vec = ones(n,1);
L1D     = spdiags([-one_vec 2*one_vec -one_vec],[-1 0 1],n,n);
R       = chol(L1D);
v       = randn(n,5);
samps   = R\v;
figure(3)
  plot(samps,'k')
  axis([0 128 min(samps(:)) max(samps(:))])

